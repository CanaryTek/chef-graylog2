#
# Generated by Chef for <%= node['fqdn'] %>                                                      
# Local modifications will be overridden
#

<VirtualHost *:80>
  ServerSignature Off
  DocumentRoot <%= node['graylog2']['web_path'] %>/current/public

  LogLevel warn
  ErrorLog    /var/log/apache2/graylog2-web-error.log
  CustomLog   /var/log/apache2/graylog2-web-access.log combined

  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
  RewriteLog /var/log/apache2/graylog2-web-interface-rewrite.log
</VirtualHost>

<VirtualHost *:443>
  ServerSignature Off
  DocumentRoot <%= node['graylog2']['web_path'] %>/current/public

  LogLevel warn
  ErrorLog    /var/log/apache2/graylog2-web-error.log
  CustomLog   /var/log/apache2/graylog2-web-access.log combined

  SSLEngine on
  SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

  LoadModule passenger_module <%= node['graylog2']['web_path'] %>/.rvm/gems/<%= node['graylog2']['ruby_version'] %>/gems/passenger-<%= node['graylog2']['passenger_version'] %>/ext/apache2/mod_passenger.so
  PassengerRoot <%= node['graylog2']['web_path'] %>/.rvm/gems/<%= node['graylog2']['ruby_version'] %>/gems/passenger-<%= node['graylog2']['passenger_version'] %>
  PassengerRuby <%= node['graylog2']['web_path'] %>/.rvm/wrappers/<%= node['graylog2']['ruby_version'] %>/ruby

  PassengerLogLevel 0
  PassengerDebugLogFile /var/log/apache2/graylog2-web-pessenger-error.log

  <Directory <%= node['graylog2']['web_path'] %>/current/public>
    Allow from all
    Options -MultiViews
  </Directory>
</VirtualHost>
