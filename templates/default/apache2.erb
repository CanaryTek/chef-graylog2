#
# Generated by Chef for <%= node['fqdn'] %>                                                      
# Local modifications will be overridden
#

<VirtualHost *:80>
  ServerSignature Off
  DocumentRoot <%= node['GRAYLOG2']['WEB_PATH'] %>/current/public

  LogLevel warn
  ErrorLog    /var/log/apache2/graylog2-web-error.log
  CustomLog   /var/log/apache2/graylog2-web-access.log combined

  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
  RewriteLog /var/log/apache2/graylog2-web-interface-rewrite.log
</VirtualHost>

<VirtualHost *:443>
  ServerSignature Off
  DocumentRoot <%= node['GRAYLOG2']['WEB_PATH'] %>/current/public

  LogLevel warn
  ErrorLog    /var/log/apache2/graylog2-web-error.log
  CustomLog   /var/log/apache2/graylog2-web-access.log combined

  SSLEngine on
  SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

  LoadModule passenger_module <%= node['GRAYLOG2']['WEB_PATH'] %>/.RVM/GEMS/<%= node['GRAYLOG2']['RUBY_VERSION'] %>/GEMS/PASSENGER-<%= node['GRAYLOG2']['PASSENGER_VERSION'] %>/ext/apache2/mod_passenger.so
  PassengerRoot <%= node['GRAYLOG2']['WEB_PATH'] %>/.RVM/GEMS/<%= node['GRAYLOG2']['RUBY_VERSION'] %>/GEMS/PASSENGER-<%= node['GRAYLOG2']['PASSENGER_VERSION'] %>
  PassengerRuby <%= node['GRAYLOG2']['WEB_PATH'] %>/.RVM/WRAPPERS/<%= node['GRAYLOG2']['RUBY_VERSION'] %>/ruby

  PassengerLogLevel 0
  PassengerDebugLogFile /var/log/apache2/graylog2-web-pessenger-error.log

  <Directory <%= node['GRAYLOG2']['WEB_PATH'] %>/current/public>
    Allow from all
    Options -MultiViews
  </Directory>
</VirtualHost>
